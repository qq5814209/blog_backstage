<!DOCTYPE html>
<html class="x-admin-sm">
    
    <head>
        <meta charset="UTF-8">
        <title>用户列表</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">
        <script src="./lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="./js/xadmin.js"></script>

    </head>
    <body>
        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">
                            <form class="layui-form layui-col-space5">
                                 <div class="layui-input-inline layui-show-xs-block">
                                    <input type="text" name="username" placeholder="用户名" autocomplete="off" class="layui-input">
                                </div>


<!--                                 <div class="layui-input-inline layui-show-xs-block">-->
<!--                                    <input type="text" name="username" placeholder="用户名" autocomplete="off" class="layui-input">-->
<!--                                </div>-->

                                <div class="layui-input-inline layui-show-xs-block">
                                    <select name="contrller">
                                        <option>用户身份</option>
                                        <option>普通用户</option>
                                        <option>会员</option>
                                        <option>超级会员</option></select>
                                </div>
                                <div class="layui-input-inline lafite_search layui-show-xs-block">
                                    <button class="layui-btn" lay-submit="" lay-filter="sreach">
                                        查询</button>
                                </div>
                            </form>
                        </div>
                        
<!--                        <div class="layui-card-header">-->
<!--                            <a class="layui-btn lafite_main_color" onclick="xadmin.open('新增用户','./adduser.html',600,500)"><i class="layui-icon"></i>新增用户</a>-->
<!--                        </div>-->

                        <div class="layui-card-body">
                            <table class="layui-table layui-form" id="table1">
                                <thead>
                                    <tr style="background: #F8E5E5;">
                                        <th>用户编号</th>
                                        <th>用户名</th>
                                        <th>用户实名</th>
                                        <th>用户经验</th>
                                        <th>用户身份</th>
                                        <th>到期时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
<!--                                    <tr>-->
<!--                                        <td>1</td>-->
<!--                                        <td>王小明</td>-->
<!--                                        <td>已开通</td>-->
<!--                                        <td>是</td>-->
<!--                                        <td>2016-10-08  13:00</td>-->
<!--                                        <td>2016-10-08  13:00</td>-->
<!--                                        <td class="td-manage">-->
<!--                                            <a class="lafitewu_auditing" title="编辑" onclick="xadmin.open('编辑','./edituser.html',600,500)" href="javascript:;">-->
<!--                                                编辑-->
<!--                                            </a>-->
<!--                                            <a class="lafitewu_look lafitewu_margin_left_20" title="冻结" onclick="member_revoke(this,'确认冻结吗？')" href="javascript:;">-->
<!--                                                冻结-->
<!--                                            </a>-->
<!--                                            &lt;!&ndash; <a class="lafitewu_del lafitewu_margin_left_10" title="删除" onclick="member_del(this,'要删除的id')" href="javascript:;">-->
<!--                                                删除-->
<!--                                            </a>-->
<!--                                            <a class="lafitewu_auditing lafitewu_margin_left_10" title="发布" onclick="member_revoke(this,'确认发布吗？')" href="javascript:;">-->
<!--                                                发布    -->
<!--                                            </a> &ndash;&gt;-->
<!--                                        </td>-->
<!--                                    </tr>-->
<!--                                   <tr>-->
<!--                                        <td>2</td>-->
<!--                                        <td>王小明</td>-->
<!--                                        <td>已开通</td>-->
<!--                                        <td>是</td>-->
<!--                                        <td>2016-10-08  13:00</td>-->
<!--                                         <td>2016-10-08  13:00</td>-->
<!--                                        <td class="td-manage">-->
<!--                                            <a class="lafitewu_auditing" title="查看" onclick="xadmin.open('编辑','./edituser.html',600,500)" href="javascript:;">-->
<!--                                                编辑-->
<!--                                            </a>-->
<!--                                            <a class="lafitewu_look lafitewu_margin_left_20" title="冻结" onclick="member_revoke(this,'确认冻结吗？')" href="javascript:;">-->
<!--                                                冻结-->
<!--                                            </a>-->
<!--                                        </td>-->
<!--                                    </tr>-->
<!--                                    <tr>-->
<!--                                        <td>3</td>-->
<!--                                        <td>王小明</td>-->
<!--                                        <td>已开通</td>-->
<!--                                        <td>是</td>-->
<!--                                        <td>2016-10-08  13:00</td>-->
<!--                                         <td>2016-10-08  13:00</td>-->
<!--                                        <td class="td-manage">-->
<!--                                            <a class="lafitewu_auditing" title="编辑" onclick="xadmin.open('编辑','./edituser.html',600,500)" href="javascript:;">-->
<!--                                                编辑-->
<!--                                            </a>-->
<!--                                        </td>-->
<!--                                    </tr>-->
                                </tbody>
                            </table>
                        </div>
                        <div id="lafite_pages"></div>
                        <div class="row" style="text-align:center">
                            <ul class="pagination" id="pagination">
                                <li id="btns">

                                </li>
                            </ul>
                            <p class="text-primary">当前第:<span id="currentPage"></span>页 共计<span
                                    id="totalPage"></span>页&nbsp;&nbsp;&nbsp;<input type="text" id="t" style="width: 25px;height: 22px">
                                <button class="btn-primary" onclick='goto()'>跳转</button>
                            </p>
                            <p class="text-primary">总记录数:<span id="totalNums"></span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="/jquery/jquery-2.1.1.min.js"></script>
        <script type="text/javascript">
            // layui.use(['laypage', 'laydate', 'form'],
            //     function() {
            //         var laydate = layui.laydate;
            //         var laypage = layui.laypage;
            //
            //         // 分页样式
            //         laypage.render({
            //             elem: 'lafite_pages'
            //             ,count: 100
            //             ,theme: '#D91715',
            //             jump: function(obj){
            //                 //模拟渲染
            //                 console.log(obj);
            //             }
            //         });
            //
            //         //执行一个laydate实例
            //         laydate.render({
            //             elem: '#start' //指定元素
            //         });
            //
            //         //执行一个laydate实例
            //         laydate.render({
            //             elem: '#end' //指定元素
            //         });
            //     });
            //
            // /*用户-删除*/
            // function member_del(obj, id) {
            //     layer.confirm('是否确认删除当前项目？',
            //         {title:"项目删除"},
            //         function(index) {
            //             //发异步删除数据
            //             $(obj).parents("tr").remove();
            //             layer.msg('已删除!', {
            //                 icon: 1,
            //                 time: 1000
            //             });
            //         });
            // }
            //
            // /*用户-撤销*/
            // function member_revoke(obj, id) {
            //     layer.confirm('确认冻结吗？',
            //         {title:"用户冻结"},
            //         function(index) {
            //             //发异步删除数据
            //             // $(obj).parents("tr").remove();
            //             // layer.msg('已删除!', {
            //             //     icon: 1,
            //             //     time: 1000
            //             // });
            //         });
            // }

            $(function () {
                init(1, 3);
            });

            function goNormal(n) {
                $("#table1 tr:not(:first)").empty("");
                $("#btns").find("button").remove();
                init(n, 3);
            }

            function init(currentPage, pageSize) {
                $.ajax({
                    type: 'POST',
                    url: 'selectUserInfo',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({
                        "currentPage": currentPage,
                        "pageSize": pageSize
                    }),
                    success: function (responseText) {
                        console.log(responseText)
                        //给表格添加数据
                        for (var i = 0; i < responseText.list.length; i++) {
                            var str =  "<tr><td>"+responseText.list[i].user_id+"</td>" +
                                "<td>"+responseText.list[i].user_name+"</td>\n" +
                                "<td>"+responseText.list[i].name+"</td>\n" +
                                "<td>"+responseText.list[i].value+"</td>\n" +
                                "<td>"+responseText.list[i].vip_name+"</td>\n" +
                                "<td>"+responseText.list[i].end_time+"</td>\n" +
                                "<td class=\"td-manage\">\n" +
                                "<a class=\"lafitewu_auditing\" title=\"编辑\" onclick = \"jumpToEd(" + responseText.list[i].user_id +")\" href=\"javascript:;\">\n" +
                                "编辑\n" +
                                "</a>\n" +
                                "<a class=\"lafitewu_del lafitewu_margin_left_10\" title=\"删除\" onclick='deleteUserInfoById(" + responseText.list[i].user_id+ ")' href=\"javascript:;\">\n" +
                                "删除\n" +
                                "</a>\n" +
                                "</td>\n"+
                                "</tr>";
                            $("#table1").append(str);
                        }

                        //动态生成页数
                        for (var i = 0; i < responseText.lastPage; i++) {
                            if (i == 0) {
                                //首页
                                var buttonFirst = $("<button onclick='goNormal(" + responseText.firstPage + ")' class='btn-primary'>首页</button>");
                                //是否存有上页
                                if (responseText.pageNum == 1) {
                                    var buttonPrep = $("<button onclick='goNormal(" + responseText.prePage + ")' class=\"btn-primary\" disabled='disabled'>上一页</button>")
                                } else {
                                    var buttonPrep = $("<button onclick='goNormal(" + responseText.prePage + ")' class=\"btn-primary\">上一页</button>")
                                }
                                $("#btns").append(buttonFirst);
                                $("#btns").append(buttonPrep);
                            }
                            if (i == responseText.pageNum - 1) {
                                var button = $("<button onclick='goNormal(" + (i + 1) + ")' class=\"btn-success\">" + (i + 1) + "</button>")
                            } else {
                                var button = $("<button onclick='goNormal(" + (i + 1) + ")' class=\"btn-primary\">" + (i + 1) + "</button>")
                            }
                            $("#btns").append(button);
                            if (i == responseText.lastPage - 1) {
                                //尾页
                                var buttonEnd = $("<button onclick='goNormal(" + responseText.lastPage + ")' class=\"btn-primary\">尾页</button>");
                                if (responseText.pageNum == responseText.lastPage) {
                                    var buttonNext = $("<button onclick='goNormal(" + responseText.nextPage + ")' class=\"btn-primary\" disabled='disabled'>下一页</button>")
                                } else {
                                    var buttonNext = $("<button onclick='goNormal(" + responseText.nextPage + ")' class=\"btn-primary\">下一页</button>")
                                }
                                $("#btns").append(buttonNext);
                                $("#btns").append(buttonEnd);
                            }

                        }
                        //当前页数
                        $("#currentPage").html(responseText.pageNum);
                        //总页数
                        $("#totalPage").html(responseText.lastPage);
                        //总记录数
                        $("#totalNums").html(responseText.total);
                    },
                    error: function (message) {
                        console.log(message);
                    },
                    dataType: 'json'
                });
            }

            function goto() {
                $("#table1 tr:not(:first)").empty("");
                $("#btns").find("button").remove();
                init($("#t").val(), 3);
            }


            function jumpToEd(id) {
                var url = "edituser.html?user_id=" + id;
                window.location.href = url;
            }

            function deleteUserInfoById(id) {
                $.ajax({
                    type: 'GET',
                    url: "deleteUserInfoById?user_id=" + id,
                    contentType: "application/json",
                    success: function (data) {
                        if (data) {
                            alert("删除成功");
                            window.location.reload();
                        } else {
                            alert("删除失败");
                        }
                    },
                    error: function (data) {
                        console.error(data);

                    },
                    dataType: "json"
                });
            }
        </script>
    </body>
</html>